/*
 * Pre-load necessary database. (Will be organized up as a class)
 * 
 */
        
#include "preload.h"

vector<vector<unsigned>> street_street_segments_preload() {
    vector <vector<unsigned>> street_street_segments;
    //Pre-load the vector of street IDs.
    vector <StreetIndex> street_id_pre = street_id_preload();
    
    //Loop through all street IDs and parse corresponding street segments vectors into the vector.
    for (unsigned int street_id = 0; street_id < getNumberOfStreets(); street_id++) {
        vector<unsigned> street_segments;
        
        //Loop through all street segments and parse corresponding street IDs into the vector.
        for (unsigned int i = 0; i < getNumberOfStreetSegments(); i++) {
            //Check if the street IDs match.
            if (street_id == street_id_pre[i])    
                street_segments.push_back(i);
        }
        street_street_segments.push_back(street_segments);
    }
    return street_street_segments;
}

vector <double> street_segment_length_preload() {
    vector <double> street_segment_length;
    //Pre-load the vector of curve points count.
    vector <unsigned> curve_point_count = curve_point_count_preload();
    
    //Loop through all street segments and parse corresponding segment lengths into the vector.
    for (unsigned int i = 0; i < getNumberOfStreetSegments(); i++) {
        double length = 0.0;
        StreetSegmentInfo segment_info = getStreetSegmentInfo(i);
        IntersectionIndex from = segment_info.from;
        IntersectionIndex to = segment_info.to;
        unsigned int curvePointCount = curve_point_count[i];
         
        LatLon intersection_1 = getIntersectionPosition(from);
        LatLon intersection_2 = getIntersectionPosition(to);
         
        //Find length directly if there is no curve.
        if (curvePointCount == 0) {
            length = find_distance_between_two_points(intersection_1, intersection_2);
        } else {
            LatLon temp_1 = intersection_1;
        
            //Loop through all curved segments and add their lengths up.
            for (unsigned int x = 0; x < curvePointCount; x++) {
                LatLon temp_2 = getStreetSegmentCurvePoint(i, x);
                length += find_distance_between_two_points(temp_1, temp_2);
                temp_1 = temp_2;
            }
            //Add the last curved segment length between the last point and intersection_2.
            length += find_distance_between_two_points(temp_1, intersection_2);
        }
        street_segment_length.push_back(length);
    }
    return street_segment_length;
}

vector <double> street_length_preload() {
    vector <double> street_length;

    //Loop through all street IDs and parse corresponding street lengths into the vector.
    for (unsigned int street_id = 0; street_id < getNumberOfStreets(); street_id++) {
        double length = 0.0;
        vector <unsigned> segment_id = find_street_street_segments(street_id);
        //Sum up the length of all segments on the given street.
        for (auto iter = segment_id.begin(); iter != segment_id.end(); iter++) {
            length += find_street_segment_length(*iter);
        }
        street_length.push_back(length);
    }
    return street_length;
}

vector <double> speed_limit_preload() {
    vector <double> speed_limit;
    
    //Parse all speed limits into a vector sorted by segment IDs.
    for (unsigned int segment_id = 0; segment_id < getNumberOfStreetSegments(); segment_id++) {
        speed_limit.push_back(getStreetSegmentInfo(segment_id).speedLimit);
    }
    return speed_limit;
}

vector <unsigned> curve_point_count_preload() {
    vector <unsigned> curve_point;
    
    //Parse all numbers of curve points into a vector sorted by segment IDs.
    for (unsigned int segment_id = 0; segment_id < getNumberOfStreetSegments(); segment_id++) {
        curve_point.push_back(getStreetSegmentInfo(segment_id).curvePointCount);
    }
    return curve_point;
}

vector <StreetIndex> street_id_preload() {
    vector <unsigned> street_id;
    
    //Parse all index of street into a vector sorted by segment IDs.
    for (unsigned int segment_id = 0; segment_id < getNumberOfStreetSegments(); segment_id++) {
        street_id.push_back(getStreetSegmentInfo(segment_id).streetID);
    }
    return street_id;
}


